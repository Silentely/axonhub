# æ¨¡å‹ç®¡ç†æŒ‡å—

AxonHub æä¾›çµæ´»çš„æ¨¡å‹ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒé€šè¿‡æ¨¡å‹å…³è”ï¼ˆModel Associationsï¼‰å°†æŠ½è±¡æ¨¡å‹æ˜ å°„åˆ°å…·ä½“çš„æ¸ é“å’Œæ¨¡å‹å®ç°ï¼Œå®ç°ç»Ÿä¸€çš„æ¨¡å‹æ¥å£å’Œæ™ºèƒ½çš„æ¸ é“é€‰æ‹©ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### æ¨¡å‹ï¼ˆModelï¼‰
AxonHub ä¸­çš„æ¨¡å‹æ˜¯æŠ½è±¡çš„æ¨¡å‹å®šä¹‰ï¼ŒåŒ…å«ï¼š
- **ModelID** - æ¨¡å‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¦‚ `gpt-4`ã€`claude-3-opus`ï¼‰
- **Developer** - æ¨¡å‹å¼€å‘è€…ï¼ˆå¦‚ `openai`ã€`anthropic`ï¼‰
- **Settings** - æ¨¡å‹è®¾ç½®ï¼ŒåŒ…å«å…³è”è§„åˆ™
- **ModelCard** - æ¨¡å‹å…ƒæ•°æ®ï¼ˆèƒ½åŠ›ã€æˆæœ¬ã€é™åˆ¶ç­‰ï¼‰

### æ¸ é“ï¼ˆChannelï¼‰
æ¸ é“æ˜¯å…·ä½“çš„ AI æœåŠ¡æä¾›å•†è¿æ¥ï¼ŒåŒ…å«ï¼š
- æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨
- API é…ç½®å’Œè®¤è¯ä¿¡æ¯
- æ¸ é“æƒé‡å’Œæ ‡ç­¾

### æ¨¡å‹å…³è”ï¼ˆModel Associationï¼‰
æ¨¡å‹å…³è”å®šä¹‰äº†æŠ½è±¡æ¨¡å‹ä¸æ¸ é“ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œæ”¯æŒå¤šç§åŒ¹é…ç­–ç•¥ã€‚

## ğŸ”— æ¨¡å‹ä¸æ¸ é“çš„å…³ç³»

### å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AxonHub Model â”‚ (æŠ½è±¡æ¨¡å‹)
â”‚   ID: gpt-4     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Associations (å…³è”è§„åˆ™)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ModelChannelConnection                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Channel A    â”‚  â”‚ Channel B    â”‚           â”‚
â”‚  â”‚ gpt-4-turbo  â”‚  â”‚ gpt-4        â”‚           â”‚
â”‚  â”‚ Priority: 0   â”‚  â”‚ Priority: 1  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Load Balancer (è´Ÿè½½å‡è¡¡)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Selected     â”‚ (é€‰ä¸­çš„å€™é€‰)
â”‚   Candidate     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯·æ±‚æµç¨‹

1. **è¯·æ±‚åˆ°è¾¾** - å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨æ¨¡å‹ `gpt-4`
2. **æ¨¡å‹æŸ¥è¯¢** - ç³»ç»ŸæŸ¥æ‰¾ ModelID ä¸º `gpt-4` çš„æ¨¡å‹å®ä½“
3. **å…³è”è§£æ** - æ ¹æ®æ¨¡å‹çš„ Associations è§£æåŒ¹é…çš„æ¸ é“å’Œæ¨¡å‹
4. **å€™é€‰ç”Ÿæˆ** - ç”Ÿæˆ `ChannelModelCandidate` åˆ—è¡¨
5. **è´Ÿè½½å‡è¡¡** - åº”ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥æ’åºå€™é€‰
6. **è¯·æ±‚æ‰§è¡Œ** - ä½¿ç”¨ç¬¬ä¸€ä¸ªå€™é€‰æ‰§è¡Œè¯·æ±‚
7. **å¤±è´¥é‡è¯•** - å¤±è´¥æ—¶åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå€™é€‰

## ğŸ“‹ æ¨¡å‹å…³è”ç±»å‹

### 1. channel_model - æŒ‡å®šæ¸ é“çš„æŒ‡å®šæ¨¡å‹

ç²¾ç¡®åŒ¹é…æŒ‡å®šæ¸ é“ä¸­çš„æŒ‡å®šæ¨¡å‹ã€‚

```json
{
  "type": "channel_model",
  "priority": 0,
  "channelModel": {
    "channelId": 1,
    "modelId": "gpt-4-turbo"
  }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- éœ€è¦ç²¾ç¡®æ§åˆ¶æŸä¸ªæ¨¡å‹ä½¿ç”¨ç‰¹å®šæ¸ é“
- ä¼˜å…ˆçº§æœ€é«˜çš„ä¸»åŠ›æ¸ é“

### 2. channel_regex - æŒ‡å®šæ¸ é“çš„æ­£åˆ™åŒ¹é…

åŒ¹é…æŒ‡å®šæ¸ é“ä¸­ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰æ¨¡å‹ã€‚

```json
{
  "type": "channel_regex",
  "priority": 1,
  "channelRegex": {
    "channelId": 2,
    "pattern": "gpt-4.*"
  }
}
```

**æ¨¡å¼è¯­æ³•**ï¼šæ¨¡å¼ä¼šè‡ªåŠ¨æ·»åŠ  `^` å’Œ `$` é”šç‚¹æ¥åŒ¹é…å®Œæ•´æ¨¡å‹å­—ç¬¦ä¸²ã€‚ä½¿ç”¨ `.*` è¿›è¡Œçµæ´»åŒ¹é…ï¼š
- `gpt-4.*` - åŒ¹é… `gpt-4`ã€`gpt-4-turbo`ã€`gpt-4-vision-preview`
- `.*flash.*` - åŒ¹é… `gemini-2.5-flash-preview`ã€`gemini-flash-2.0`
- `claude-3-.*-sonnet` - åŒ¹é… `claude-3-5-sonnet`ã€`claude-3-opus-sonnet`

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ¸ é“æ”¯æŒå¤šä¸ªæ¨¡å‹å˜ä½“
- éœ€è¦çµæ´»åŒ¹é…æ¨¡å‹åç§°

### 3. regex - æ‰€æœ‰æ¸ é“çš„æ­£åˆ™åŒ¹é…

åŒ¹é…æ‰€æœ‰å¯ç”¨æ¸ é“ä¸­ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å‹ã€‚

```json
{
  "type": "regex",
  "priority": 2,
  "regex": {
    "pattern": "gpt-4.*",
    "exclude": [
      {
        "channelNamePattern": ".*test.*",
        "channelIds": [5, 6],
        "channelTags": ["beta"]
      }
    ]
  }
}
```

**æ’é™¤è§„åˆ™**ï¼š
- `channelNamePattern` - æ’é™¤æ¸ é“åç§°åŒ¹é…çš„æ¸ é“
- `channelIds` - æ’é™¤æŒ‡å®š ID çš„æ¸ é“
- `channelTags` - æ’é™¤åŒ…å«æŒ‡å®šæ ‡ç­¾çš„æ¸ é“

**ä½¿ç”¨åœºæ™¯**ï¼š
- å¹¿æ³›åŒ¹é…å¤šä¸ªæ¸ é“ä¸­çš„æ¨¡å‹
- éœ€è¦æ’é™¤ç‰¹å®šæ¸ é“

### 4. model - æ‰€æœ‰æ¸ é“çš„æŒ‡å®šæ¨¡å‹

åŒ¹é…æ‰€æœ‰å¯ç”¨æ¸ é“ä¸­çš„æŒ‡å®šæ¨¡å‹ã€‚

```json
{
  "type": "model",
  "priority": 3,
  "modelId": {
    "modelId": "gpt-4",
    "exclude": [
      {
        "channelNamePattern": ".*backup.*",
        "channelIds": [10],
        "channelTags": ["low-priority"]
      }
    ]
  }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ‰€æœ‰æ”¯æŒè¯¥æ¨¡å‹çš„æ¸ é“éƒ½å¯ä½œä¸ºå€™é€‰
- éœ€è¦æ’é™¤ç‰¹å®šæ¸ é“

### 5. channel_tags_model - æ ‡ç­¾æ¸ é“çš„æŒ‡å®šæ¨¡å‹

åŒ¹é…å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„æ¸ é“ä¸­çš„æŒ‡å®šæ¨¡å‹ï¼ˆOR é€»è¾‘ï¼‰ã€‚

```json
{
  "type": "channel_tags_model",
  "priority": 4,
  "channelTagsModel": {
    "channelTags": ["production", "high-performance"],
    "modelId": "gpt-4"
  }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ ¹æ®æ¸ é“æ ‡ç­¾é€‰æ‹©å€™é€‰
- ç¯å¢ƒéš”ç¦»ï¼ˆç”Ÿäº§/æµ‹è¯•ï¼‰

### 6. channel_tags_regex - æ ‡ç­¾æ¸ é“çš„æ­£åˆ™åŒ¹é…

åŒ¹é…å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„æ¸ é“ä¸­ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å‹ï¼ˆOR é€»è¾‘ï¼‰ã€‚

```json
{
  "type": "channel_tags_regex",
  "priority": 5,
  "channelTagsRegex": {
    "channelTags": ["openai", "azure"],
    "pattern": "gpt-4.*"
  }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ ¹æ®æä¾›å•†æ ‡ç­¾é€‰æ‹©
- çµæ´»åŒ¹é…æ¨¡å‹å˜ä½“

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæ¨¡å‹

```bash
curl -X POST http://localhost:8090/api/models \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -d '{
    "developer": "openai",
    "modelId": "gpt-4",
    "name": "GPT-4",
    "type": "chat",
    "group": "gpt",
    "icon": "ğŸ¤–",
    "settings": {
      "associations": [
        {
          "type": "channel_model",
          "priority": 0,
          "channelModel": {
            "channelId": 1,
            "modelId": "gpt-4-turbo"
          }
        },
        {
          "type": "regex",
          "priority": 1,
          "regex": {
            "pattern": "gpt-4.*",
            "exclude": [
              {
                "channelTags": ["test"]
              }
            ]
          }
        }
      ]
    }
  }'
```

### 2. é…ç½®æ¸ é“

ç¡®ä¿æ¸ é“å·²é…ç½®å¹¶æ”¯æŒç›¸åº”çš„æ¨¡å‹ï¼š

```bash
curl -X POST http://localhost:8090/api/channels \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -d '{
    "name": "OpenAI Primary",
    "type": "openai",
    "enabled": true,
    "weight": 100,
    "tags": ["production", "openai"],
    "config": {
      "apiKey": "sk-...",
      "baseUrl": "https://api.openai.com/v1"
    },
    "models": [
      {
        "requestModel": "gpt-4",
        "actualModel": "gpt-4-turbo"
      }
    ]
  }'
```

### 3. ä½¿ç”¨æ¨¡å‹

å®¢æˆ·ç«¯ä½¿ç”¨æŠ½è±¡çš„ ModelID è¯·æ±‚ï¼š

```python
from openai import OpenAI

client = OpenAI(
    api_key="your-axonhub-api-key",
    base_url="http://localhost:8090/v1"
)

response = client.chat.completions.create(
    model="gpt-4",  # ä½¿ç”¨æŠ½è±¡çš„ ModelID
    messages=[{"role": "user", "content": "Hello!"}]
)
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æŸ¥æ‰¾ `gpt-4` æ¨¡å‹å®ä½“
2. è§£æå…³è”è§„åˆ™
3. é€‰æ‹©æœ€ä¼˜æ¸ é“
4. æ˜ å°„åˆ°å®é™…æ¨¡å‹ï¼ˆå¦‚ `gpt-4-turbo`ï¼‰

## ğŸ›ï¸ é«˜çº§é…ç½®

### ä¼˜å…ˆçº§æ§åˆ¶

å…³è”æŒ‰ä¼˜å…ˆçº§é¡ºåºå¤„ç†ï¼Œä¼˜å…ˆçº§å€¼è¶Šå°è¶Šä¼˜å…ˆï¼š

```json
{
  "settings": {
    "associations": [
      {
        "type": "channel_model",
        "priority": 0,  // æœ€é«˜ä¼˜å…ˆçº§
        "channelModel": {
          "channelId": 1,
          "modelId": "gpt-4-turbo"
        }
      },
      {
        "type": "regex",
        "priority": 10,  // è¾ƒä½ä¼˜å…ˆçº§
        "regex": {
          "pattern": "gpt-4.*"
        }
      }
    ]
  }
}
```

### å»é‡æœºåˆ¶

ç³»ç»Ÿè‡ªåŠ¨å»é‡ï¼ŒåŒä¸€ä¸ªï¼ˆæ¸ é“ï¼Œæ¨¡å‹ï¼‰ç»„åˆåªä¼šå‡ºç°ä¸€æ¬¡ã€‚

### ç¼“å­˜ä¼˜åŒ–

å…³è”è§£æç»“æœä¼šè¢«ç¼“å­˜ï¼Œç¼“å­˜å¤±æ•ˆæ¡ä»¶ï¼š
- æ¸ é“æ•°é‡å˜åŒ–
- æ¸ é“æ›´æ–°æ—¶é—´å˜åŒ–
- æ¨¡å‹æ›´æ–°æ—¶é—´å˜åŒ–
- ç¼“å­˜è¿‡æœŸï¼ˆ5 åˆ†é’Ÿï¼‰

### å›é€€ç­–ç•¥

å½“æ¨¡å‹ä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥å›é€€åˆ°ä¼ ç»Ÿçš„æ¸ é“é€‰æ‹©ï¼š

```json
{
  "queryAllChannelModels": true,
  "fallbackToChannelsOnModelNotFound": true
}
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹æ¨¡å‹å…³è”

```bash
# æŸ¥è¯¢æ¨¡å‹çš„æ¸ é“è¿æ¥
curl -X POST http://localhost:8090/api/models/connections \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -d '{
    "associations": [
      {
        "type": "regex",
        "regex": {
          "pattern": "gpt-4.*"
        }
      }
    ]
  }'
```

### æŸ¥çœ‹æœªå…³è”çš„æ¸ é“

```bash
curl -X GET http://localhost:8090/api/models/unassociated-channels \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### è°ƒè¯•æ—¥å¿—

```bash
# æŸ¥çœ‹æ¨¡å‹é€‰æ‹©æ—¥å¿—
tail -f axonhub.log | grep "selected model candidates"

# æŸ¥çœ‹å…³è”è§£ææ—¥å¿—
tail -f axonhub.log | grep "association resolution"

# æŸ¥çœ‹å€™é€‰é€‰æ‹©æ—¥å¿—
tail -f axonhub.log | grep "Load balanced candidates"
```

## ğŸ”§ æœ€ä½³å®è·µ

### 1. æ¨¡å‹è®¾è®¡

- **ä½¿ç”¨æ ‡å‡†åŒ–çš„ ModelID** - å¦‚ `gpt-4`ã€`claude-3-opus`
- **åˆç†çš„ä¼˜å…ˆçº§è®¾ç½®** - ä¸»åŠ›æ¸ é“ä¼˜å…ˆçº§ 0-10ï¼Œå¤‡ç”¨æ¸ é“ 10-100
- **çµæ´»ä½¿ç”¨æ­£åˆ™** - é¿å…è¿‡äºå®½æ³›çš„æ¨¡å¼

### 2. æ¸ é“ç»„ç»‡

- **ä½¿ç”¨æ ‡ç­¾åˆ†ç±»** - å¦‚ `production`ã€`test`ã€`backup`
- **è®¾ç½®åˆç†çš„æƒé‡** - é…åˆè´Ÿè½½å‡è¡¡ä½¿ç”¨
- **å®šæœŸæ¸…ç†** - ç§»é™¤ä¸å†ä½¿ç”¨çš„æ¸ é“

### 3. å…³è”ç­–ç•¥

- **ç²¾ç¡®ä¼˜å…ˆ** - ä½¿ç”¨ `channel_model` ä½œä¸ºä¸»åŠ›æ¸ é“
- **çµæ´»å¤‡ç”¨** - ä½¿ç”¨ `regex` æˆ– `model` ä½œä¸ºå¤‡ç”¨
- **ç¯å¢ƒéš”ç¦»** - ä½¿ç”¨æ ‡ç­¾å…³è”åŒºåˆ†ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒ

### 4. æ€§èƒ½ä¼˜åŒ–

- **åˆ©ç”¨ç¼“å­˜** - å…³è”è§£æç»“æœä¼šè¢«ç¼“å­˜
- **é¿å…é¢‘ç¹æ›´æ–°** - å‡å°‘æ¨¡å‹å’Œæ¸ é“çš„æ›´æ–°é¢‘ç‡
- **ç›‘æ§å€™é€‰æ•°é‡** - è¿‡å¤šçš„å€™é€‰ä¼šå½±å“æ€§èƒ½

## ğŸ› å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¯·æ±‚å¤±è´¥äº†ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ¨¡å‹æ˜¯å¦å­˜åœ¨ä¸”å·²å¯ç”¨
2. å…³è”è§„åˆ™æ˜¯å¦æ­£ç¡®é…ç½®
3. æ¸ é“æ˜¯å¦å¯ç”¨ä¸”æ”¯æŒç›¸åº”æ¨¡å‹
4. æŸ¥çœ‹æ—¥å¿—äº†è§£å…·ä½“é”™è¯¯

### Q: å¦‚ä½•éªŒè¯å…³è”æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

A:
1. ä½¿ç”¨ `/api/models/connections` API æŸ¥è¯¢å…³è”ç»“æœ
2. å¯ç”¨è°ƒè¯•æ—¥å¿—æŸ¥çœ‹å€™é€‰é€‰æ‹©è¿‡ç¨‹
3. å‘é€æµ‹è¯•è¯·æ±‚éªŒè¯è·¯ç”±

### Q: æ”¯æŒå¤šå°‘ä¸ªå…³è”è§„åˆ™ï¼Ÿ

A: ç†è®ºä¸Šæ— é™åˆ¶ï¼Œä½†å»ºè®®ï¼š
- å•ä¸ªæ¨¡å‹ä¸è¶…è¿‡ 10 æ¡å…³è”
- æ€»å…³è”æ•°é‡ä¸è¶…è¿‡ 100 æ¡
- é¿å…è¿‡äºå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼

### Q: å¦‚ä½•å®ç° A/B æµ‹è¯•ï¼Ÿ

A: ä½¿ç”¨ç›¸åŒä¼˜å…ˆçº§çš„å¤šä¸ªå…³è”ï¼š

```json
{
  "settings": {
    "associations": [
      {
        "type": "channel_model",
        "priority": 0,
        "channelModel": {
          "channelId": 1,
          "modelId": "gpt-4-turbo"
        }
      },
      {
        "type": "channel_model",
        "priority": 0,
        "channelModel": {
          "channelId": 2,
          "modelId": "gpt-4"
        }
      }
    ]
  }
}
```

è´Ÿè½½å‡è¡¡ä¼šåœ¨ç›¸åŒä¼˜å…ˆçº§çš„å€™é€‰ä¸­é€‰æ‹©ã€‚

### Q: å¦‚ä½•æ’é™¤ç‰¹å®šæ¸ é“ï¼Ÿ

A: ä½¿ç”¨ `exclude` å­—æ®µï¼š

```json
{
  "type": "regex",
  "regex": {
    "pattern": "gpt-4.*",
    "exclude": [
      {
        "channelNamePattern": ".*test.*",
        "channelIds": [5, 6],
        "channelTags": ["beta"]
      }
    ]
  }
}
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è‡ªé€‚åº”è´Ÿè½½å‡è¡¡æŒ‡å—](load-balance.md)
- [API Key Profiles æŒ‡å—](api-key-profiles.md)
- [ç»Ÿä¸€ API æ–‡æ¡£](../api-reference/unified-api.md)
- [è¿½è¸ªå’Œè°ƒè¯•](tracing.md)
